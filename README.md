# 📌 ESTsoft Perso.ai Chatbot
### Perso.ai 바이브코딩 (미래내일일경험 인턴십) 과제
<https://estsoft-chatbot.streamlit.app/>

FastAPI 기반 백엔드와 Streamlit 프론트엔드로 구성된 챗봇입니다. OpenAI 임베딩을 활용해 생성한 벡터를 Qdrant 벡터 데이터베이스에 저장하고, 사용자 질의에 대해 유사도 검색을 수행한 뒤 검증된 답변을 제공합니다.

## 1. 사용 기술 스택
**[사용 언어]**
- Python 3.10

**[프레임워크]**
- FastAPI (Backend)
- Streamlit (Frontend)

**[배포]**
- Render
- Streamlit Cloud
- Qdrant Cloud

**[벡터 DB]**
- Qdrant (Vector DB, Cosine Similarity 기반 검색)

**[임베딩]**
- OpenAI Embeddings API (`text-embedding-3-small` 기본값)


## 2. 벡터 DB 및 임베딩 방식
### 임베딩 생성

**[QA 데이터 처리]**

: Q&A.xlsx → OpenAI 임베딩 → Qdrant DB

**[입력 데이터 처리]**

: 사용자 질문 → Qdrant 벡터 DB에 대해 similarity search(유사도 검색)를 수행 → Top-5 후보 선택 → 가장 유사한 답변만 반환


- 직접 생성하여 할루시네이션이 발생하는 것을 최소화하고자, 의미적으로 가장 유사한 답변을 찾아 출력했습니다.
- `backend/embedder.py`에서 OpenAI SDK를 사용하여 텍스트 임베딩을 생성합니다. (`Embedder.embed`)
- 최대 3회 재시도를 통해 일시적 오류에 대응하며, 네트워크 예외(`OpenAIError`, `httpx.HTTPError`)를 핸들링합니다.
- 기본 모델은 환경 변수 `EMBEDDING_MODEL`을 통해 설정 가능하며, 기본값은 `text-embedding-3-small`입니다. 모델 변경 시 백엔드 재배포 없이 환경 변수 수정만으로 반영됩니다.

### 벡터 데이터베이스(Qdrant)
- `backend/retriever.py`에서 Qdrant 클라이언트를 초기화하고, 컬렉션 미존재 시 자동 생성합니다. (임베딩 차원 1536, 코사인 유사도)
- `Retriever.search`는 Top-K 검색(`TOP_K`, 기본 5)을 수행하며 결과에 payload(`answer`, `question`, `source`)를 함께 반환합니다.
- 유사도 점수가 임계값(`SIM_THRESHOLD`, 기본 0.82) 아래로 떨어질 경우 경고 메시지를 추가해 결과 신뢰도를 표시합니다.


## 3. 정확도 향상 전략
1) **사전 임베딩 후 가장 유사한 답변 출력**
   - 답변을 "즉석에서 생성"하지 않고, 사전에 정제된 Q/A 데이터(Excel → 벡터 DB) 중에서 가장 유사한 항목을 조회하는 구조로 설계했습니다.
   - 데이터에 질문/답변이 비어 있는 경우 예외를 발생시켜 스크립트를 중단합니다. 이 과정을 통해 형식이 깨진 Q/A, 불완전한 데이터가 벡터 DB에 들어가는 것을 사전에 차단하여, 검색 품질 저하를 막았습니다.
   - “질문 임베딩 → 유사도 검색” 역할만 수행하도록 제한하여, 부정확한 정보를 지어내는 할루시네이션 가능성을 줄였습니다.


2) **고품질 임베딩과 재시도**
   - OpenAI의 고성능 임베딩 모델을 사용해 질의와 문서 간 의미적 유사도를 높이고, API 실패 시 최대 3회 재시도로 일관된 벡터 품질을 확보했습니다.


3) **Qdrant 기반 Top-K 유사도 검색**
   - 코사인 유사도 기반 Top-K 검색으로 가장 관련성 높은 문서를 우선 조회하고, 응답에 원본 질문/출처를 포함해 검증 가능성을 높였습니다.
   - Top-5를 조회하지만 실제로는 가장 유사한 Top-1만 사용합니다. (Top-1로 설정해도 결과는 동일하지만, 추가 기능 확장할 경우를 고려하여 기본 값 유지)
   - 문장 간 의미 비교에 적합한 Cosine Similarity를 사용했습니다. (문장의 길이보다는 의미적 유사도에 집중)


4) **구성 가능한 파라미터**
   - `.env` 환경 변수로 모델, Top-K, 임계값 등을 조정하여 데이터 도메인에 맞는 최적화가 가능하며, 이를 통해 재학습 없이 정확도를 개선할 수 있습니다.


## 추가 설명
- Render 무료 플랜을 사용하여 15분간 활동이 없으면 서비스가 일시 중단됩니다.
- 일시 중단 후 사용하면 처음 50초가량 로딩이 걸릴 수 있습니다.
